{% extends "base.html" %}

{% block title %}SSI{% endblock %}

{% block content %}
<div class="container mt-3">
    <div class="header">
        <h1>Generar Reportes</h1>
    </div>
    <div class="form-container">
        <form id="reportForm" method="post" action="{{ url_for('pagina2') }}">
            <!-- Primera fila: Horas -->
            <div class="form-group">
                <label for="hours_input" style="font-size: 1.2rem;">Analizar por 1, 12 o 24 horas:</label>
                <input type="text" class="form-control" id="hours_input" name="hours_input" placeholder="Ingrese 1, 12 o 24" required>
            </div>
            <!-- Segunda fila: Días julianos -->
            <div class="form-group">
                <label for="julian_days" style="font-size: 1.2rem;">Días julianos a ser analizados:</label>
                <input type="text" class="form-control" id="julian_days" name="julian_days" placeholder="Ejemplo: 123, 124" required>
            </div>
            <!-- Tercera fila: Botón de generar reportes -->
            <div class="form-group">
                <button type="button" class="btn btn-primary" id="generateBtn" style="font-size: 1.2rem; border: 2px solid #000;">
                    Generar Reportes
                </button>
            </div>
            <!-- Input oculto para seleccionar carpeta -->
            <input type="file" id="folderInput" webkitdirectory directory multiple style="display: none;">
        </form>
    </div>
</div>

<script>
// Al hacer clic en "Generar Reportes", se validan los campos de entrada
document.getElementById("generateBtn").addEventListener("click", function(){
    var hoursInput = document.getElementById("hours_input").value.trim();
    var julianDays = document.getElementById("julian_days").value.trim();
    
    // Validar el campo de horas: no vacío, numérico y que sea 1, 12 o 24
    if(hoursInput === "" || isNaN(hoursInput)){
        alert("Por favor, ingrese un número válido para 'Analizar por 1, 12 o 24 horas'.");
        return;
    }
    if(!(["1", "12", "24"].includes(hoursInput))){
        alert("El valor para 'Analizar por 1, 12 o 24 horas' debe ser 1, 12 o 24.");
        return;
    }
    
    // Validar el campo de días julianos: no vacío y números separados por coma
    if(julianDays === ""){
        alert("Por favor, ingrese los días julianos a ser analizados.");
        return;
    }
    var daysArray = julianDays.split(",").map(function(day){ return day.trim(); });
    for(var i = 0; i < daysArray.length; i++){
        if(daysArray[i] === "" || isNaN(daysArray[i])){
            alert("Por favor, ingrese días julianos válidos (números separados por coma).");
            return;
        }
    }
    
    // Si pasa la validación, se abre el selector de carpeta
    document.getElementById("folderInput").click();
});

// Cuando se selecciona la carpeta, se envía el formulario al backend
document.getElementById("folderInput").addEventListener("change", function(){
    document.getElementById("reportForm").submit();
});
</script>
{% endblock %}
